{% extends "base.html" %}

{% block title %}{{ tag.name() }}{% endblock %}

{% block header %}
  <h2 class="text-secondary">{{ tag.name() }}</h2>
{% endblock %}

{% block body %}
  {% for category in categories %}
    <section class="{{ category.filter_class()|safe }}">
      <h3 class="text-primary"><a name="{{ category }}"></a>{{ category }}</h3>
      {% for subtag in self.subtags() %}
        {% if self.subtag_has_cards_in_category(subtag.clone(), category) %}
          <section>
            <h4 class="text-secondary"><a name="{{ category }}-{{ subtag.name() }}"></a>{{ subtag.name() }}</h4>
            {% if subtag.has_alt_names() %}
              <h6>Alternate Names: {{ subtag.alt_names_string() }}</h6>
            {% endif %}
            {% for card in self.get_tag_cards(subtag.clone()).unwrap() %}
              {% if card.has_category(category) %}
                {% include "card.html" %}
              {% endif %}
            {% endfor %}
          </section>
        {% endif %}
      {% endfor %}
      {% if self.has_untagged_cards_in_category(category) %}
        <section>
          <h4><a name="{{ category }}-Other"></a>Other</h4>
          {% for card in self.get_untagged_cards().unwrap() %}
            {% if card.has_category(category) %}
              {% include "card.html" %}
            {% endif %}
          {% endfor %}
        </section>
      {% endif %}
    </section>
  {% endfor %}
{% endblock %}